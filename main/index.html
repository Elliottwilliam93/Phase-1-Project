<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Find Your Favorite DnD Monster!</title>
    <link type="text/css" rel="stylesheet" href="index.css" />
    <script type="text/javascript" src="index.js"></script>
  </head>
  <body>
    <main>
      <h1 class="title">Welcome to DnD5E Monster Finder!</h1>
      <div class="search-bar">
      <label for="myInput">Search Monster Here!</label>
      <input type="text" id="myInput" />

      <button onclick="storeInputValue()">Search</button>
      </div>
      <section id="demo"></section>
    </main>
    <input type="text" id="comment-box" placeholder="Enter Comment">
    <button id="post">Post</button>
    <ul id="unordered">

    <template id="card-template">
      <div class="card">
        <h5 class="card-title"></h5>
        <div class="cr-img"></div>
        <div class="card-details">
          <p><strong>Size: </strong><span class="card-size"></span></p>
          <p><strong>Type: </strong><span class="card-type"></span></p>
          <p><strong>Alignment: </strong><span class="card-alignment"></span></p>
          <p><strong>Challenge Rating: </strong><span class="card-challenge_rating"></span></p>
        </div>
        <button class="like-button">Like</button>
      </div>
    </template>

    <script>
      let storedValue;
      const cardTemplate = document.getElementById("card-template");

      function storeInputValue() {
        // Get the input element
        let input = document.getElementById("myInput");

        // Store the value in the global variable
        storedValue = input.value;
        useStoredValue();
      }

      function convertSpacesToDashes(str) {
        return str.replace(/\s+/g, "-");
      }

      function useStoredValue() {
        let lowerValue = storedValue.toLowerCase();
        let newValue = convertSpacesToDashes(lowerValue);
        let mydata = fetch(`https://api.open5e.com/monsters/${newValue}`)
          .then((response) => response.json())
          .then((data) => {
            // Access the monster list from the data
            console.log(data);
            const element = data;
            console.log(element);
            let crSRC;

            if (element.challenge_rating <= 5 ) {
              crSRC = '<img src="resources/diablo3-difficulty-levels (2).png" style="height: 150px; width: 150px; border-radius: 25px;">'
            }
            else if (element.challenge_rating <= 10 ) {
              crSRC = '<img src="resources/diablo3-difficulty-levels.png" style="height: 150px; width: 150px; border-radius: 25px;">'
            }
            else if (element.challenge_rating <= 15 ) {
              crSRC = '<img src="resources/diablo3-difficulty-levels (3).png" style="height: 150px; width: 150px; border-radius: 25px;">'
            }
            else {
              crSRC = '<img src="resources/diablo3-difficulty-levels (4).png" style="height: 150px; width: 150px; border-radius: 25px;">'
            }

            // Create a new card with the retrieved monster's information
            if(element.detail === "Not found.") {
              alert("Monster Not Found!")
            }else {
            const newCard = cardTemplate.content.cloneNode(true);
            newCard.querySelector(".card-title").textContent = element.name;
            newCard.querySelector(".card-size").textContent = element.size;
            newCard.querySelector(".card-type").textContent = element.type;
            newCard.querySelector(".cr-img").innerHTML = crSRC
            newCard.querySelector(".card-alignment").textContent = element.alignment;
            newCard.querySelector(".card-challenge_rating").textContent = element.challenge_rating
            
            // Add a like button to the new card
            const likeButton = newCard.querySelector(".like-button");
            let likes = 0;
            likeButton.addEventListener("click", () => {
              likes++;
              likeButton.textContent = `Like (${likes})`;
            });

            // Display the new card on the webpage
            const demoSection = document.getElementById("demo");
            demoSection.appendChild(newCard);
          }
            storedValue = "";
            mydata = "";
          })
          .catch((error) => {
            // Handle any errors that occur during the fetch request
            
          });
      }
      const post= document.getElementById("post");
       post.addEventListener("click", function(){
       let commentBoxValue= document.getElementById("comment-box").value;
 
        let li = document.createElement("li");
        let text = document.createTextNode(commentBoxValue);
        li.appendChild(text);
        document.getElementById("unordered").appendChild(li);
 
      });
    </script>
  </body>
</html>